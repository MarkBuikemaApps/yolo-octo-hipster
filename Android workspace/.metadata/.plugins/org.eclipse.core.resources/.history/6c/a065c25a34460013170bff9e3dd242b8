package com.markbuikema.juliana32.adapter;

import java.util.ArrayList;
import java.util.List;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import android.content.Context;
import android.widget.ArrayAdapter;

import com.markbuikema.juliana32.model.Member;
import com.markbuikema.juliana32.util.Util;

public class ContactAdapter extends ArrayAdapter<Member> {

	private List<List<Member>> content;
	private List<String> headers;
	private List<Boolean> isHeader;

	public ContactAdapter(Context context) {
		super(context, 0);
		try {
			content = new ArrayList<List<Member>>();
			headers = new ArrayList<String>();

			JSONObject object = new JSONObject(Util.loadJSONFromAsset(getContext(), "contacts.json"));
			JSONArray categories = object.getJSONArray("categories");
			for (int i = 0; i < categories.length(); i++) {
				JSONObject category = categories.getJSONObject(i);
				headers.add(category.getString("name"));
				content.add(new ArrayList<Member>());
				JSONArray members = category.getJSONArray("members");
				for (int j = 0; j < members.length(); j++) {
					JSONObject memberObject = members.getJSONObject(j);
					String name = memberObject.getString("name");
					String function = memberObject.getString("function");
					String phoneNumber = memberObject.getString("phoneNumber");
					String email = memberObject.getString("email");
					Member member = new Member(name, function, phoneNumber, email);
					content.get(i).add(member);
				}
			}

			isHeader = new ArrayList<Boolean>(getCount());
			for (List<Member> list : content) {
				isHeader.add(true);
				for (Member m : list)
					isHeader.add(false);
			}

		} catch (JSONException e) {
			e.printStackTrace();
		}
	}

	@Override
	public int getViewTypeCount() {
		return 2;
	}

	@Override
	public int getItemViewType(int position) {
		return isHeader.get(position).booleanValue() ? 0 : 1;
	}

	@Override
	public int getCount() {
		int count = 0;
		for (List<Member> memberList : content) {
			count += memberList.size() + 1;
		}
		return count;
	}

}
